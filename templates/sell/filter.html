<div class="container px-5">
    <div class="row border-bottom border-1 mb-2 p-3">
        <h5 class="col-md-2 col-4 fw-bold">格局</h5>
        <div class="col">
            <div class="row">
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="pattern" value="=1" id="pattern_option1"> 1 房
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="pattern" value="=2" id="pattern_option2"> 2 房
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="pattern" value="=3" id="pattern_option3"> 3 房
                </label>
                <label class="col">
                    <input class="form-check-input" type="checkbox" name="pattern" value=">=4" id="pattern_option4"> 4
                    房以上
                </label>
            </div>
        </div>
    </div>

    <div class="row border-bottom border-1 mb-2 p-3">
        <h5 class="col-md-2 col-4 fw-bold">型態</h5>
        <div class="col">
            <div class="row">
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="houseType" value="公寓"
                           id="houseType_option1">
                    公寓
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="houseType" value="電梯大樓"
                           id="houseType_option2">
                    電梯大樓
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="houseType" value="透天厝"
                           id="houseType_option3">
                    透天厝
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="houseType" value="別墅"
                           id="houseType_option4">
                    別墅
                </label>
            </div>
        </div>
    </div>

    <div class="row border-bottom border-1 mb-2 p-3">
        <h5 class="col-md-2 col-4 fw-bold">售價</h5>
        <div class="col">
            <div class="row"><label class="col-lg-2 col-md-3 col-sm-6 col-12">
                <input class="form-check-input" type="checkbox" name="price" value="< 1000" id="price_option1"> 1千萬以下
            </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="price" value="BETWEEN 1000 AND 2000"
                           id="price_option2">
                    1-2千萬
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="price" value="BETWEEN 2000.1 AND 3000"
                           id="price_option3">
                    2-3千萬
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="price" value="BETWEEN 3000.1 AND 4000"
                           id="price_option4">
                    3-4千萬
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="price" value="BETWEEN 4000.1 AND 5000"
                           id="price_option5">
                    4-5千萬
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="price" value="BETWEEN 5000.1 AND 6000"
                           id="price_option6">
                    5-6千萬
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="price" value=">6000" id="price_option7"> 6千萬以上
                </label>
            </div>
        </div>

    </div>

    <div class="row border-bottom border-1 mb-2 p-3">
        <h5 class="col-md-2 col-4 fw-bold">權狀</h5>
        <div class="col">
            <div class="row">
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="twPing" value="< 20" id="twPing_option1">
                    20坪以下
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="twPing" value="BETWEEN 20 AND 30"
                           id="twPing_option2"> 20坪-30坪
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="twPing" value="BETWEEN 30.1 AND 40"
                           id="twPing_option3"> 30坪-40坪
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="twPing" value="BETWEEN 40.1 AND 50"
                           id="twPing_option4"> 40坪-50坪
                </label>
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="twPing" value="> 50" id="twPing_option5">
                    50坪以上
                </label>
            </div>
        </div>

    </div>

    <div class="row border-bottom border-1 mb-2 p-3">
        <h5 class="col-md-2 col-4 fw-bold">屋齡</h5>
        <div class="col">
            <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                <input class="form-check-input" type="checkbox" name="age" value="< 5" id="age_option1"> 5年以下
            </label>
            <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                <input class="form-check-input" type="checkbox" name="age" value="BETWEEN 5.1 AND 10" id="age_option2">
                5-10年
            </label>
            <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                <input class="form-check-input" type="checkbox" name="age" value="BETWEEN 10.1 AND 15" id="age_option3">
                10-15年
            </label>
            <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                <input class="form-check-input" type="checkbox" name="age" value="BETWEEN 15.1 AND 20" id="age_option4">
                15-20年
            </label>
            <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                <input class="form-check-input" type="checkbox" name="age" value="> 20" id="age_option5"> 20年以上
            </label>
            <div class="row">
            </div>
        </div>
    </div>

    <div class="row mb-2 p-3">
        <h5 class="col-md-2 col-4 fw-bold">自己貼文</h5>
        <div class="col">
            <div class="row">
                <label class="col-lg-2 col-md-3 col-sm-6 col-12">
                    <input class="form-check-input" type="checkbox" name="myPost" value="1" id="myPost_option1"> 我的貼文
                </label>
                <label class="col">
                    <input class="form-check-input" type="checkbox" name="myPost" value="0" id="myPost_option2"> 其他人的貼文
                </label>
            </div>
        </div>
    </div>
</div>

<div class="container px-5">
    <div class="row border-bottom">
        <div class="col-md-6">
            <div class="fw-bold fs-3 py-3">
                共找到<strong class="text-danger">{{ post_results|length }}</strong>間房子
            </div>
        </div>
        <div class="col-md-6 d-flex justify-content-end">
            <div class="mx-0">
                <input class="me-2" type="checkbox" id="sort-checkbox" name="priceOrder">
                <label id="sort" for="sort-checkbox">
                    <i class="fas fa-arrow-down btn btn-outline-secondary">金額
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             class="bi bi-arrow-down" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"></path>
                        </svg>
                    </i>
                    <i class="fas fa-arrow-up btn btn-outline-secondary active">金額
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             class="bi bi-arrow-up" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"></path>
                        </svg>
                    </i>
                </label>
            </div>
            <div class="mx-0">
                <input class="me-2" type="checkbox" id="sort-checkbox-2" name="twPingOrder">
                <label id="sort" for="sort-checkbox-2">
                    <i class="fas fa-arrow-down btn btn-outline-secondary">坪數
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             class="bi bi-arrow-down" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"></path>
                        </svg>
                    </i>
                    <i class="fas fa-arrow-up  btn btn-outline-secondary active">坪數
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             class="bi bi-arrow-up" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"></path>
                        </svg>
                    </i>
                </label>
            </div>
        </div>
    </div>
</div>

<script>
    function filter(filter_name, defaults, selectedFilter) {
        const filterOptions = document.querySelectorAll('input[name="' + filter_name + '"]');
        filterOptions.forEach((option) => {
            option.checked = option.value === selectedFilter;
            option.addEventListener("change", (event) => {
                let selectedFilter;
                if (event.target.checked) {
                    filterOptions.forEach((option) => {
                        if (option !== event.target && option.checked) {
                            option.checked = false;
                        }
                    });
                    selectedFilter = event.target.value;
                } else {
                    selectedFilter = defaults;
                }
                const obj = {};
                obj[filter_name] = selectedFilter;
                localStorage.setItem(filter_name, selectedFilter);
                $.ajax({
                    type: 'POST',
                    url: '/update/' + filter_name,
                    contentType: 'application/json;charset=UTF-8',
                    data: JSON.stringify(obj),
                    success: function () {
                        window.location.reload();
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            });
        });
    }

    function initializeFilters(filterName, defaults) {
        const selectedFilter = localStorage.getItem(filterName) || "{{ session.get('" + filterName + "', '" + defaults + "') }}";
        filter(filterName, defaults, selectedFilter);
    }

    function initializeSellType() {
        const selectedHouseType = "{{ session.get('selected_houseType', 'All') }}";
        filter("houseType", "All", selectedHouseType);
    }

    initializeFilters("pattern", ">=0");
    initializeFilters("price", ">=0");
    initializeFilters("twPing", ">=0");
    initializeFilters("age", ">=0");
    initializeFilters("myPost", "All");

    initializeSellType();

    function order(order_name, name, defaults) {
        const orderOption = document.querySelector('input[name="' + order_name + '"]');
        orderOption.checked = localStorage.getItem(orderOption.id) === "true";
        orderOption.addEventListener("change", (event) => {
            let obj = {};
            if (event.target.checked) {
                localStorage.setItem(event.target.id, 'true');

                obj[order_name] = " ORDER BY " + name.toUpperCase() + " ASC";
            } else {
                localStorage.setItem(event.target.id, 'false');
                obj[order_name] = defaults;
            }
            console.log(obj['priceOrder'])
            $.ajax({
                type: 'POST',
                url: '/update/' + order_name,
                contentType: 'application/json;charset=UTF-8',
                data: JSON.stringify(obj),
                success: function () {
                    window.location.reload();
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
    }

    order("priceOrder", "price", " ORDER BY PRICE DESC")
    order("twPingOrder", "twPing", " ORDER BY PRICE DESC")
</script>
